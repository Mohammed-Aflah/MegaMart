<%-include('../partials/header.ejs') %>
<div class="home" style="display: flex;align-items: center;justify-content: center;">
    <div class="otp-form">
        <!-- Email OTP Form -->
        <form class="email-otp" method="post" action="/mail/confirm" onsubmit="otpFormSubmit(event)">
            <h2>Email OTP</h2>
            
                <p id="err" style="width: 150px;margin:auto;visibility: hidden;"> <span id="showErr"></span> <a onclick="errClose()"><img src="/images/cross.png" style="width: 13px;height:13px" alt=""></a></p>

            <div class="email-otp-container">
                <!-- Six input fields for OTP digits -->
                <input type="text" class="email-otp-input" pattern="\d" maxlength="1">
                <input type="text" class="email-otp-input" pattern="\d" maxlength="1" disabled>
                <input type="text" class="email-otp-input" pattern="\d" maxlength="1" disabled>
                <input type="text" class="email-otp-input" pattern="\d" maxlength="1" disabled>
                <input type="text" class="email-otp-input" pattern="\d" maxlength="1" disabled>
                <input type="text" class="email-otp-input" pattern="\d" maxlength="1" disabled>
            </div>
            
            <!-- Field to display entered OTP -->
            <input type="text" id="emailverificationCode" placeholder="Enter verification code" name="verifyNum" readonly style="visibility: hidden;">
            <!-- <div>Expires In: <span id="date">10s</span> </div> -->
            
            <!-- Button to verify OTP -->
            <button type="submit" id="verifyEmailOTP">VERIFY &amp; PROCEED</button>
        </form>
      </div>
</div>
<script>
    //let count = 60;
    //let time = setInterval(() => {
    //    count--;
    //
    //    if (count <= 9) {
    //        document.getElementById("date").textContent = `0${count}s`;
    //    } else {
    //        document.getElementById("date").textContent = count + 's';
    //    }
    //
    //    if (count === 0) {
    //        clearInterval(time);
    //        document.getElementById('otpstatus').innerHTML = `<span style="color:red;">OTP Expired
    //            <a href="" style="text-decoration:underline;color:#42414d;">Resend Otp</a>
    //        </span>`;
    //    }
    //}, 1000);
    let formValue=document.getElementById('emailverificationCode')
    const ErrDiv=document.getElementById('err')
    const showErr=document.getElementById("showErr")
    function otpFormSubmit(event){

        event.preventDefault()
        let formData={
            verifyNum:formValue.value
        }
        fetch('/mail/confirm/',{
            method:"POST",
            headers:{'Content-Type': 'application/json'},
            body:JSON.stringify(formData)
        }).then((response)=>response.json()).then((res)=>{
            if(res.status){
                location.href='/'
            }
            if(res.err){
                ErrDiv.style.visibility = 'visible';
                showErr.textContent = res.err;
                setTimeout(()=>{
                    ErrDiv.style.visibility='hidden'
                },3000)
            }
        })
    }
    function errClose(){
        document.getElementById("err").style.visibility='hidden'
    }
</script>
<%-include('../partials/footer.ejs') %>